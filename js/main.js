// chatbot.js - Asistente Virtual Jim Tattoo Ink
class ChatBot {
    constructor() {
        this.widget = document.getElementById('chatbotWidget');
        this.container = document.getElementById('chatbotContainer');
        this.toggle = document.getElementById('chatbotToggle');
        this.close = document.getElementById('chatbotClose');
        this.messages = document.getElementById('chatbotMessages');
        this.input = document.getElementById('chatbotInput');
        this.send = document.getElementById('chatbotSend');
        this.quickQuestions = document.querySelectorAll('.quick-question');
        
        this.init();
    }
    
    init() {
        // Event listeners
        this.toggle.addEventListener('click', () => this.toggleChat());
        this.close.addEventListener('click', () => this.closeChat());
        this.send.addEventListener('click', () => this.sendMessage());
        this.input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.sendMessage();
        });
        
        // Quick questions
        this.quickQuestions.forEach(button => {
            button.addEventListener('click', (e) => {
                const question = e.target.getAttribute('data-question');
                this.addUserMessage(question);
                this.processQuestion(question);
            });
        });
    }
    
    toggleChat() {
        this.container.classList.toggle('active');
    }
    
    closeChat() {
        this.container.classList.remove('active');
    }
    
    addUserMessage(text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message user-message';
        messageDiv.innerHTML = `<p>${text}</p>`;
        this.messages.appendChild(messageDiv);
        this.scrollToBottom();
    }
    
    addBotMessage(text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message bot-message';
        messageDiv.innerHTML = `<p>${text}</p>`;
        this.messages.appendChild(messageDiv);
        this.scrollToBottom();
    }
    
    scrollToBottom() {
        this.messages.scrollTop = this.messages.scrollHeight;
    }
    
    sendMessage() {
        const text = this.input.value.trim();
        if (text) {
            this.addUserMessage(text);
            this.input.value = '';
            this.processQuestion(text);
        }
    }
    
    processQuestion(question) {
        const q = question.toLowerCase();
        let response = '';
        let actions = [];
        
        // 1. SALUDO
        if (q.includes('hola') || q.includes('buenas') || q.includes('hi') || q.includes('hello')) {
            response = "¬°Hola! Soy el asistente de Jim Tattoo Ink. Puedo ayudarte con informaci√≥n sobre precios, piercings, cuidados, recomendaciones o conectar con Jim.";
        }
        // 2. PRECIOS TATUAJES
        else if (q.includes('precio') || q.includes('cu√°nto') || q.includes('cuesta') || q.includes('valor')) {
            if (q.includes('tatuaje')) {
                response = "Los tatuajes var√≠an seg√∫n tama√±o: peque√±os desde 40‚Ç¨, medianos 80-150‚Ç¨, grandes desde 200‚Ç¨. ¬øTe interesa alg√∫n estilo en particular?";
                actions.push({text: "üì± Consultar dise√±o espec√≠fico", action: "whatsapp"});
            } else if (q.includes('piercing')) {
                response = "Piercings desde 15‚Ç¨: Nariz (15‚Ç¨), Lengua (20‚Ç¨), Ombligo (20‚Ç¨), Pez√≥n (25‚Ç¨), Industrial (20‚Ç¨), Microdermal (40‚Ç¨). Todos incluyen joyer√≠a inicial.";
                actions.push({text: "üíé Ver todos los piercings", action: "piercings"});
            } else {
                response = "Puedo ayudarte con precios de tatuajes o piercings. ¬øQu√© te interesa m√°s?";
            }
        }
        // 3. TIPOS PIERCING
        else if (q.includes('piercing') || q.includes('perforaci√≥n') || q.includes('perforar')) {
            response = "Hacemos: Nariz Desde (15‚Ç¨), Lengua Desde (20‚Ç¨), Ombligo (20‚Ç¨), Pez√≥n (25‚Ç¨), Industrial (20‚Ç¨), Microdermal (40‚Ç¨)";
            actions.push({text: "üìç Ver todos los piercings", action: "piercings"});
        }
        // 4. RESERVAS
        else if (q.includes('reserva') || q.includes('cita') || q.includes('appointment') || q.includes('agendar')) {
            response = "Puedes reservar por WhatsApp al +34 615 796 188 o por Instagram en @jimtattooink. Tambi√©n nos puedes visitar en Barcelona con cita previa.";
            actions.push({text: "üì± Reservar por WhatsApp", action: "whatsapp"});
        }
        // 5. UBICACI√ìN
        else if (q.includes('ubicaci√≥n') || q.includes('d√≥nde') || q.includes('direcci√≥n') || q.includes('local') || q.includes('estudio')) {
            response = "Estamos en Barcelona, Espa√±a. Trabajamos con cita previa para mejor atenci√≥n.";
            actions.push({text: "üó∫Ô∏è Ver informaci√≥n de contacto", action: "contact"});
        }
        // 6. CUIDADOS PIERCING
        else if (q.includes('cuidado') && q.includes('piercing')) {
            response = "Limpia 2-3 veces al d√≠a con soluci√≥n salina est√©ril. No gires la joya, evita piscinas y manipulaci√≥n. Usa ropa holgada si es corporal. La curaci√≥n toma 6 semanas a 6 meses seg√∫n ubicaci√≥n.";
        }
        // 7. CUIDADOS TATUAJE
        else if (q.includes('cuidado') && q.includes('tattoo') || q.includes('tatuaje')) {
            response = "Retira el vendaje despu√©s de 2-3 horas. Lava suavemente con jab√≥n neutro, seca con toques y aplica crema espec√≠fica 2-3 veces al d√≠a. Evita sol, piscinas y rascado durante 2 semanas.";
        }
        // 8. IRRITACI√ìN
        else if (q.includes('irritaci√≥n') || q.includes('irrita') || q.includes('molestia')) {
            response = "Si hay enrojecimiento leve o hinchaz√≥n, es normal. Aplica compresas fr√≠as y soluci√≥n salina. Si hay dolor intenso, pus o fiebre, consulta m√©dico inmediatamente.";
        }
        // 9. REDES SOCIALES
        else if (q.includes('instagram') || q.includes('redes') || q.includes('social') || q.includes('@') || q.includes('tiktok')) {
            response = "¬°S√≠guenos en @jimtattooink en Instagram y TikTok para ver nuestro trabajo!";
            actions.push({text: "üì∏ Seguir en Instagram", action: "instagram"});
        }
        // 10. M√âTODO PERFORACI√ìN
        else if (q.includes('m√©todo') || q.includes('pistola') || q.includes('aguja') || q.includes('cat√©ter')) {
            response = "Solo usamos AGUJA EST√âRIL tipo cat√©ter. NUNCA pistolas, que da√±an el tejido. T√©cnica m√°s precisa, menos dolorosa y m√°s segura.";
        }
        // 11. DOLOR Y DURACI√ìN PIERCING
        else if ((q.includes('dolor') || q.includes('duele')) && q.includes('piercing')) {
            response = "Dolor breve como un pellizco. La perforaci√≥n dura segundos. Todo el proceso (preparaci√≥n, marcado, perforaci√≥n) unos 15-20 minutos.";
        }
        // 12. ESTERILIZACI√ìN
        else if (q.includes('esteril') || q.includes('higiene') || q.includes('limpio') || q.includes('seguro')) {
            response = "S√ç. Todo material es EST√âRIL y de UN SOLO USO. Agujas, tubos, guantes, contenedores... La m√°quina se forra completamente con material est√©ril desechable. Todo se descarta despu√©s de cada cliente.";
        }
        // 13. MATERIALES JOYER√çA
        else if (q.includes('material') || q.includes('joyer√≠a') || q.includes('acero') || q.includes('bioflex') || q.includes('titani')) {
            response = "Inicialmente: Acero quir√∫rgico 316L para la mayor√≠a, Bioflex para zonas con flexibilidad. Ambos hipoalerg√©nicos y de calidad profesional.";
        }
        // 14. JOYA PROPIA
        else if (q.includes('propia') || q.includes('llevar') || q.includes('traer') && q.includes('joya')) {
            response = "No recomendado. Usamos joyer√≠a profesional esterilizada espec√≠fica para perforaci√≥n inicial para garantizar seguridad y correcta curaci√≥n.";
        }
        // 15. CAMBIO DE JOYA
        else if (q.includes('cambiar') || q.includes('cambio') && q.includes('joya')) {
            response = "Despu√©s de la curaci√≥n completa: 6-8 semanas para nariz/oreja, 6-12 semanas para ombligo, 4-6 semanas para lengua. Te aconsejamos cu√°ndo es seguro.";
        }
        // 16. TIEMPO CURACI√ìN
        else if (q.includes('cura') || q.includes('sana') || q.includes('cicatriza') && q.includes('piercing')) {
            response = "L√≥bulo: 6-8 semanas. Cart√≠lago: 4-12 meses. Ombligo: 6-12 meses. Lengua: 4-6 semanas. Nariz: 2-4 meses.";
        }
        // 17. PRODUCTOS LIMPIEZA
        else if (q.includes('limpiar') || q.includes('producto') || q.includes('limpia') || q.includes('jab√≥n')) {
            response = "Soluci√≥n salina est√©ril o agua marina espec√≠fica para piercings. NUNCA alcohol, per√≥xido o pomadas antibi√≥ticas.";
        }
        // 18. S√çNTOMAS NORMALES
        else if (q.includes('normal') || q.includes('preocup') || q.includes('s√≠ntoma')) {
            response = "NORMAL: Hinchaz√≥n leve, enrojecimiento, sensibilidad primera semana. PREOCUPANTE: Dolor intenso, pus amarillo/verde, fiebre, sangrado excesivo.";
        }
        // 19. PRESUPUESTOS
        else if (q.includes('presupuesto') || q.includes('cotizaci√≥n') || q.includes('presupu')) {
            response = "Env√≠a tu idea por WhatsApp/Instagram con referencia de tama√±o y ubicaci√≥n. Jim te dar√° presupuesto personalizado.";
            actions.push({text: "üì± Enviar dise√±o", action: "whatsapp"});
        }
        // 20. PRECIO POR HORA
        else if (q.includes('hora') || q.includes('tiempo') && q.includes('precio')) {
            response = "Generalmente por dise√±o/pieza. Para trabajos muy extensos puede ser por sesi√≥n. Siempre presupuesto claro antes de empezar.";
        }
        // 21. DISE√ëOS PERSONALIZADOS
        else if (q.includes('dise√±o') || q.includes('copiar') || q.includes('internet') || q.includes('personal')) {
            response = "¬°S√≠ claro! Puedes traer tus dise√±os y nos adaptamos a ellos, aunque preferimos crear dise√±os √öNICOS y personalizados. Podemos inspirarnos en referencias pero cada tatuaje es original y hecho espec√≠ficamente para ti.";
        }
        // 22. PROCESO DISE√ëO
        else if (q.includes('proceso') && q.includes('dise√±o')) {
            response = "Consulta ‚Üí Boceto personalizado ‚Üí Revisi√≥n y ajustes ‚Üí Aprobaci√≥n ‚Üí Cita. Incluye 2 revisiones del dise√±o.";
        }
        // 23. MEDIDAS HIGIENE
        else if (q.includes('higiene') || q.includes('seguridad') || q.includes('limpieza')) {
            response = "Protocolo completo: TODO desechable (agujas, tubos, guantes, contenedores de tinta). La m√°quina se forra completamente con material est√©ril desechable. Todo se descarta despu√©s de cada cliente.";
        }
        // 24. DOLOR TATUAJE
        else if ((q.includes('dolor') || q.includes('duele')) && q.includes('tatuaje')) {
            response = "Var√≠a seg√∫n zona y tolerancia. Zonas con m√°s terminaciones nerviosas (costillas, pies) son m√°s sensibles. Puedes usar crema anest√©sica previa consulta.";
        }
        // 25. DURACI√ìN SESI√ìN
        else if (q.includes('dura') || q.includes('sesi√≥n') || q.includes('tiempo') && q.includes('tatuaje')) {
            response = "Peque√±os: 30 minutos - 1 hora. Medianos: 1 - 2 horas. Grandes pueden requerir varias sesiones.";
        }
        // 26. PREPARACI√ìN CITA
        else if (q.includes('prepara') || q.includes('antes') || q.includes('cita')) {
            response = "Descansar bien, comer ligero, hidratarse, no tomar alcohol 24h antes, llevar ropa c√≥moda.";
        }
        // 27. INFECCI√ìN TATUAJE
        else if (q.includes('infecci√≥n') || q.includes('infecta') || q.includes('infectado')) {
            response = "Se√±ales: Enrojecimiento que empeora despu√©s de 3 d√≠as, pus, dolor intenso, fiebre. Si sospechas infecci√≥n, consulta m√©dico inmediatamente.";
        }
        // 28. RETOQUES
        else if (q.includes('retoque') || q.includes('retocar') || q.includes('arreglar')) {
            response = "S√ç. Retoques menores GRATIS dentro de los primeros 3 meses. Algunos colores pueden necesitar retoque para intensidad √≥ptima.";
        }
        // 29. HORARIO
        else if (q.includes('horario') || q.includes('hora') || q.includes('abre') || q.includes('cierra')) {
            response = "Lunes a Viernes: 10:00-22:00, S√°bados: 11:00-22:00, Domingos: 11:00-20:00. Siempre con cita previa.";
            actions.push({text: "üó∫Ô∏è Ver contacto completo", action: "contact"});
        }
        // 30. DEP√ìSITO
        else if (q.includes('dep√≥sito') || q.includes('se√±a') || q.includes('reserva')) {
            response = "S√ç, dep√≥sito del 30% para reservar cita. Se deduce del precio final. Garantiza tu espacio y cubre dise√±o personalizado.";
        }
        // 31. FORMAS DE PAGO
        else if (q.includes('pago') || q.includes('tarjeta') || q.includes('efectivo') || q.includes('bizum')) {
            response = "Bizum y efectivo. Para trabajos grandes se puede fraccionar pago.";
        }
        // 32. OTRAS PREGUNTAS
        else {
            response = "Puedo ayudarte con informaci√≥n b√°sica. Para consultas espec√≠ficas, te recomiendo contactar a Jim directamente por WhatsApp al +34 615 796 188";
            actions.push({text: "üì± Contactar por WhatsApp", action: "whatsapp"});
            actions.push({text: "üì∏ Ver Instagram", action: "instagram"});
        }
        
        // Agregar respuesta con delay para simular typing
        setTimeout(() => {
            this.addBotMessage(response);
            
            // Agregar botones de acci√≥n si existen
            if (actions.length > 0) {
                setTimeout(() => {
                    actions.forEach(action => {
                        this.addActionButton(action.text, action.action);
                    });
                }, 500);
            }
        }, 1000);
    }
    
    addActionButton(text, action) {
        const button = document.createElement('button');
        button.className = 'quick-question action-button';
        button.textContent = text;
        button.addEventListener('click', () => this.handleAction(action));
        
        const quickQuestions = document.querySelector('.chatbot-quick-questions');
        quickQuestions.appendChild(button);
        this.scrollToBottom();
    }
    
    handleAction(action) {
        switch(action) {
            case 'whatsapp':
                window.open('https://wa.me/34615796188', '_blank');
                break;
            case 'instagram':
                window.open('https://instagram.com/jimtattooink', '_blank');
                break;
            case 'piercings':
                window.location.href = 'pages/piercings.html';
                break;
            case 'contact':
                window.location.href = '../index.html#contacto';
                break;
        }
        this.closeChat();
    }
}

// Inicializar chatbot cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', () => {
    new ChatBot();
});